(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{5312:function(e,t,s){Promise.resolve().then(s.bind(s,410))},7515:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},5862:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},933:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5733:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},2513:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3225:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},9738:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},4697:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=(0,s(1066).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},4316:function(e,t,s){"use strict";s.d(t,{supabase:function(){return n}});var a=s(6887);let r="https://ofuyghemecqstflnhixy.supabase.co",l="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9mdXlnaGVtZWNxc3RmbG5oaXh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzMDQ0NzUsImV4cCI6MjA3ODg4MDQ3NX0.kD12l4KnDFZuRNFCSOEIQWKCGdvy8CBCnuL2ukC0TAc",i=r?r.replace(/\/$/,"").replace(/^(https?:\/\/)?/,"https://"):"https://placeholder.supabase.co";r&&l?l.length<50&&console.error("❌ Invalid Supabase anon key:",{keyLength:l.length,keyPreview:l.substring(0,30)+"...",message:"Anon key appears to be a placeholder or too short. Please check Vercel environment variables."}):(console.error("❌ Missing Supabase environment variables:",{url:r?"✓":"✗",key:l?"✓":"✗",urlValue:r||"MISSING",keyValue:l?"".concat(l.substring(0,20),"..."):"MISSING"}),console.error("Please set NEXT_PUBLIC_SUPABASE_URL and NEXT_PUBLIC_SUPABASE_ANON_KEY in Vercel environment variables and redeploy."));let n=(0,a.eI)(i,l||"placeholder-key",{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}})},410:function(e,t,s){"use strict";s.d(t,{Dashboard:function(){return _}});var a=s(7437),r=s(2265),l=s(4316),i=s(1066);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,i.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var o=s(2513),d=s(3225),c=s(5733),u=s(933);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let m=(0,i.Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);var p=s(5862);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,i.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var g=s(7515),h=s(9738),y=s(4697);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let b=(0,i.Z)("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var f=s(357);async function j(e,t){let s=new FormData;s.append("file",e),s.append("path",t),console.log("\uD83D\uDCE4 Sending upload request to /api/upload",{path:t,fileName:e.name,fileSize:e.size});let a=await fetch("/api/upload",{method:"POST",body:s});if(console.log("\uD83D\uDCE5 Upload response:",{status:a.status,ok:a.ok}),!a.ok){let e=await a.json().catch(()=>({message:"Upload failed"}));throw console.error("❌ Upload API error:",e),Error(e.error||e.message||"Upload failed with status ".concat(a.status))}let r=await a.json();return console.log("✅ Upload successful, URL:",r.url),r.url}f.env.HETZNER_S3_BUCKET,f.env.HETZNER_CDN_URL,f.env.HETZNER_S3_ENDPOINT,f.env.HETZNER_S3_BUCKET_PUBLIC;let v=["Blantyre","Lilongwe","Mzuzu","Zomba","Mangochi","Kasungu","Salima","Nkhotakota","Dedza","Ntchisi","Dowa","Mchinji","Karonga","Chitipa","Rumphi","Nkhata Bay","Likoma","Balaka","Chiradzulu","Mulanje","Phalombe","Thyolo","Chikwawa","Nsanje","Machinga","Mwanza","Neno","Ntcheu"];function N(e){let{agent:t,userId:s,property:i,onClose:n,onSuccess:o}=e,[d,c]=(0,r.useState)(!1),[u,m]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[h,f]=(0,r.useState)({title:"",description:"",property_type:"land",district:"",area:"",price:"",currency:"MWK",plot_size:"",plot_dimensions:"",bedrooms:"",bathrooms:"",has_title_deed:!1,documentation_type:"",reason_for_selling:"",is_urgent_sale:!1,status:"available"}),[N,w]=(0,r.useState)([]),[_,k]=(0,r.useState)([]),[S,C]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(i){var e;f({title:i.title,description:i.description||"",property_type:i.property_type,district:i.district,area:i.area||"",price:i.price.toString(),currency:i.currency,plot_size:(null===(e=i.plot_size)||void 0===e?void 0:e.toString())||"",plot_dimensions:"",bedrooms:i.bedrooms.toString(),bathrooms:i.bathrooms.toString(),has_title_deed:i.has_title_deed,documentation_type:i.documentation_type||"",reason_for_selling:i.reason_for_selling||"",is_urgent_sale:i.is_urgent_sale,status:i.status}),w(i.images||[])}},[i]),(0,r.useEffect)(()=>()=>{S.forEach(e=>URL.revokeObjectURL(e))},[S]);let D=e=>{w(t=>t.filter((t,s)=>s!==e))},z=e=>{k(t=>t.filter((t,s)=>s!==e)),C(t=>{let s=[...t],[a]=s.splice(e,1);return a&&URL.revokeObjectURL(a),s})},P=e=>{if(!e||!e.trim())return null;let t=e.trim().toLowerCase(),s=t.match(/(\d+(?:\.\d+)?)\s*by\s*(\d+(?:\.\d+)?)/);if(s){let e=parseFloat(s[1]),t=parseFloat(s[2]);if(!isNaN(e)&&!isNaN(t)&&e>0&&t>0)return Math.round(e*t*100)/100}let a=t.match(/(\d+(?:\.\d+)?)\s*x\s*(\d+(?:\.\d+)?)/);if(a){let e=parseFloat(a[1]),t=parseFloat(a[2]);if(!isNaN(e)&&!isNaN(t)&&e>0&&t>0)return Math.round(e*t*100)/100}return null},E=e=>{let t=P(e);null!==t?f(s=>({...s,plot_dimensions:e,plot_size:t.toString()})):e.trim()?f(t=>({...t,plot_dimensions:e})):f(t=>({...t,plot_dimensions:e,plot_size:""}))},M=async()=>{if(!_.length)return console.log("\uD83D\uDCF8 No new images to upload"),[];console.log("\uD83D\uDCF8 Uploading ".concat(_.length," image(s) to Hetzner Storage..."));let e=[];for(let t of _){let a=t.name.split(".").pop()||"jpg",r="property-".concat(s,"/").concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(a);console.log("  Uploading: ".concat(t.name," -> ").concat(r));try{let s=await j(t,r);console.log("  ✅ Uploaded: ".concat(s)),e.push(s)}catch(e){throw console.error("  ❌ Upload failed for ".concat(t.name,":"),e),Error("Failed to upload ".concat(t.name,": ").concat(e.message||"Unknown error"))}}return console.log("✅ All images uploaded: ".concat(e.length," URL(s)")),e},Z=async()=>{if(i&&window.confirm('Are you sure you want to delete "'.concat(i.title,'"?\n\nThis action cannot be undone. The property and all its associated data will be permanently removed.'))){c(!0),m("");try{if(console.log("\uD83D\uDDD1️ Deleting property: ".concat(i.title)),N.length>0)for(let e of(console.log("\uD83D\uDDD1️ Deleting ".concat(N.length," image(s) from Hetzner storage...")),N))try{if(e.includes("your-objectstorage.com")||e.includes("hetzner")){let t=await fetch("/api/delete-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e})});if(t.ok)console.log("  ✅ Deleted image: ".concat(e));else{let s=await t.json().catch(()=>({message:"Delete failed"}));console.warn("  ⚠️ Failed to delete image ".concat(e,":"),s.error||s.message)}}else console.log("  ⏭️ Skipping Supabase image (bucket may be deleted): ".concat(e))}catch(t){console.warn("  ⚠️ Error deleting image ".concat(e,":"),t)}let{error:e}=await l.supabase.from("properties").delete().eq("id",i.id);if(e)throw e;t&&t.total_listings>0&&await l.supabase.from("agents").update({total_listings:Math.max(0,t.total_listings-1)}).eq("id",t.id),console.log("✅ Property deleted successfully:",i.id),o({message:"Property deleted successfully!"}),n()}catch(e){console.error("❌ Error deleting property:",e),m(e.message||"Failed to delete property"),c(!1)}}},U=async e=>{e.preventDefault(),c(!0),m("");try{var a;let e=await M(),r=[...N,...e],n=null,d={title:h.title,description:h.description||null,property_type:h.property_type,district:h.district,area:h.area||null,price:parseFloat(h.price),currency:h.currency,plot_size:h.plot_size?parseFloat(h.plot_size):null,bedrooms:h.bedrooms?parseInt(h.bedrooms):0,bathrooms:h.bathrooms?parseInt(h.bathrooms):0,has_title_deed:h.has_title_deed,documentation_type:h.documentation_type||null,reason_for_selling:h.reason_for_selling||null,is_urgent_sale:h.is_urgent_sale,status:h.status,images:r.length>0?r:[],agent_id:(null==t?void 0:t.id)||null,owner_id:t?null:s};if(console.log("\uD83D\uDCBE Saving property data:",{title:d.title,status:d.status,imagesCount:d.images.length,images:d.images,agent_id:d.agent_id,owner_id:d.owner_id}),i){let{data:e,error:t}=await l.supabase.from("properties").update(d).eq("id",i.id).select("*").single();if(t)throw t;n=e,w(r)}else{let{data:e,error:s}=await l.supabase.from("properties").insert(d).select("*").single();if(s)throw s;n=e,t&&await l.supabase.from("agents").update({total_listings:t.total_listings+1}).eq("id",t.id)}k([]),C(e=>(e.forEach(e=>URL.revokeObjectURL(e)),[]));let c=i?"Property updated successfully!":"Property added successfully!";console.log("✅ Property saved successfully:",{id:null==n?void 0:n.id,title:null==n?void 0:n.title,status:null==n?void 0:n.status,imagesCount:(null==n?void 0:null===(a=n.images)||void 0===a?void 0:a.length)||0,images:null==n?void 0:n.images}),o({message:c,property:n||void 0})}catch(e){console.error("❌ Error saving property:",e),m(e.message||"Failed to save property")}finally{c(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:i?"Edit Property":"Add New Property"}),(0,a.jsx)("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(y.Z,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:U,className:"p-6",children:[u&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:u}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Photos"}),(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("label",{className:"w-full cursor-pointer flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-600 transition-colors",children:[(0,a.jsx)(b,{size:20}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Click to upload (PNG, JPG up to 5MB each)"}),(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{g("");let t=Array.from(e.target.files||[]);if(!t.length){k([]),C(e=>(e.forEach(e=>URL.revokeObjectURL(e)),[]));return}if(t.length+N.length>10){g("Please upload up to ".concat(10," images in total."));return}let s=t.find(e=>e.size>5242880);if(s){g('"'.concat(s.name,'" is too large. Max size is ').concat(5,"MB per image."));return}let a=t.map(e=>URL.createObjectURL(e));k(t),C(e=>(e.forEach(e=>URL.revokeObjectURL(e)),a))}})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:"You can upload up to 10 images. The first photo will be used as the cover image."}),p&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:p})]}),(N.length>0||S.length>0)&&(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[N.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-gray-500 mb-2",children:"Existing Images"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:N.map((e,t)=>(0,a.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200",children:[(0,a.jsx)("img",{src:e,alt:"Property image ".concat(t+1),className:"w-full h-32 object-cover"}),(0,a.jsx)("button",{type:"button",onClick:()=>D(t),className:"absolute top-2 right-2 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,a.jsx)(x,{size:14})})]},e))})]}),S.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs uppercase text-gray-500 mb-2",children:"New Images"}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:S.map((e,t)=>(0,a.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200",children:[(0,a.jsx)("img",{src:e,alt:"New property image ".concat(t+1),className:"w-full h-32 object-cover"}),(0,a.jsx)("button",{type:"button",onClick:()=>z(t),className:"absolute top-2 right-2 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:(0,a.jsx)(x,{size:14})})]},e))})]})]})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Title *"}),(0,a.jsx)("input",{type:"text",required:!0,value:h.title,onChange:e=>f({...h,title:e.target.value}),placeholder:"e.g., 3 Bedroom House in Area 47",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,a.jsx)("textarea",{value:h.description,onChange:e=>f({...h,description:e.target.value}),rows:4,placeholder:"Describe the property...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Type *"}),(0,a.jsxs)("select",{required:!0,value:h.property_type,onChange:e=>f({...h,property_type:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"land",children:"Land"}),(0,a.jsx)("option",{value:"house",children:"House"}),(0,a.jsx)("option",{value:"rental",children:"Rental"}),(0,a.jsx)("option",{value:"commercial",children:"Commercial"}),(0,a.jsx)("option",{value:"mixed",children:"Mixed Use"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"District *"}),(0,a.jsxs)("select",{required:!0,value:h.district,onChange:e=>f({...h,district:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select district"}),v.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specific Area"}),(0,a.jsx)("input",{type:"text",value:h.area,onChange:e=>f({...h,area:e.target.value}),placeholder:"e.g., Area 47, Sector 3",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,a.jsxs)("select",{value:h.status,onChange:e=>f({...h,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"available",children:"Available"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"sold",children:"Sold"}),(0,a.jsx)("option",{value:"withdrawn",children:"Withdrawn"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price *"}),(0,a.jsx)("input",{type:"number",required:!0,value:h.price,onChange:e=>f({...h,price:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency *"}),(0,a.jsxs)("select",{required:!0,value:h.currency,onChange:e=>f({...h,currency:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"MWK",children:"MWK"}),(0,a.jsx)("option",{value:"USD",children:"USD"}),(0,a.jsx)("option",{value:"ZAR",children:"ZAR"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plot Dimensions (meters)"}),(0,a.jsx)("input",{type:"text",value:h.plot_dimensions,onChange:e=>E(e.target.value),placeholder:"e.g., 23 by 25 or 23x25",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:'Enter dimensions like "23 by 25" or "23x25" (automatically calculates area)'})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Plot Size (m\xb2) ",(0,a.jsx)("span",{className:"text-gray-400 text-xs",children:"(calculated automatically)"})]}),(0,a.jsx)("input",{type:"number",value:h.plot_size,onChange:e=>f({...h,plot_size:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50",readOnly:!!h.plot_dimensions,title:h.plot_dimensions?"Calculated from dimensions above":""})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bedrooms"}),(0,a.jsx)("input",{type:"number",value:h.bedrooms,onChange:e=>f({...h,bedrooms:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bathrooms"}),(0,a.jsx)("input",{type:"number",value:h.bathrooms,onChange:e=>f({...h,bathrooms:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documentation Type"}),(0,a.jsx)("input",{type:"text",value:h.documentation_type,onChange:e=>f({...h,documentation_type:e.target.value}),placeholder:"e.g., Title Deed, Lease Agreement",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Selling (optional)"}),(0,a.jsx)("input",{type:"text",value:h.reason_for_selling,onChange:e=>f({...h,reason_for_selling:e.target.value}),placeholder:"e.g., Relocation, Investment, Financial",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"has_title_deed",checked:h.has_title_deed,onChange:e=>f({...h,has_title_deed:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("label",{htmlFor:"has_title_deed",className:"ml-2 text-sm text-gray-700",children:"Has Title Deed"})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",id:"is_urgent_sale",checked:h.is_urgent_sale,onChange:e=>f({...h,is_urgent_sale:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),(0,a.jsx)("label",{htmlFor:"is_urgent_sale",className:"ml-2 text-sm text-gray-700",children:"Urgent Sale"})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[i&&(0,a.jsxs)("button",{type:"button",onClick:Z,disabled:d,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[(0,a.jsx)(x,{size:18}),"Delete"]}),(0,a.jsx)("button",{type:"button",onClick:n,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:d,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Saving...":i?"Update Property":"Add Property"})]})]})]})})}function w(e){let{property:t,onClose:l,onSuccess:i}=e,[n,o]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)(""),[x,g]=(0,r.useState)(""),[h,b]=(0,r.useState)(""),f=async()=>{o(!0),b("");try{let{supabase:e}=await Promise.resolve().then(s.bind(s,4316)),{error:a}=await e.from("properties").update({status:"sold",sold_at:new Date().toISOString(),sale_price:null,buyer_type:null}).eq("id",t.id);if(a)throw a;i(),l()}catch(e){b(e.message||"Failed to mark property as sold")}finally{o(!1)}},j=async e=>{e.preventDefault(),o(!0),b("");try{let{supabase:e}=await Promise.resolve().then(s.bind(s,4316)),a={status:"sold",sold_at:new Date().toISOString()};if(u){let e=parseFloat(u);if(isNaN(e)||e<0)throw Error("Sale price must be a valid positive number");a.sale_price=e}x&&(a.buyer_type=x);let{error:r}=await e.from("properties").update(a).eq("id",t.id);if(r)throw r;i(),l()}catch(e){b(e.message||"Failed to mark property as sold")}finally{o(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:(0,a.jsx)(p.Z,{className:"text-green-600",size:24})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Mark as Sold"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:t.title})]})]}),(0,a.jsx)("button",{onClick:l,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:n,children:(0,a.jsx)(y.Z,{size:20})})]}),(0,a.jsx)("div",{className:"p-6",children:d?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-700",children:"Mark this property as sold? It will be hidden from the marketplace but remain visible in your dashboard."}),h&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:l,disabled:n,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:f,disabled:n,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Marking..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{size:18}),"Mark as Sold"]})})]}),(0,a.jsx)("button",{type:"button",onClick:()=>c(!1),className:"w-full text-sm text-blue-600 hover:text-blue-700 text-center py-2",children:"+ Add sale details (optional)"})]}):(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-gray-700 text-sm mb-4",children:"Help us improve market intelligence by sharing sale details. All fields are optional."}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Sale Price (",t.currency,")",(0,a.jsx)("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),(0,a.jsx)("input",{type:"number",value:u,onChange:e=>m(e.target.value),placeholder:t.price.toString(),min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Listed price: ",t.currency," ",t.price.toLocaleString()]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Buyer Type",(0,a.jsx)("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),(0,a.jsxs)("select",{value:x,onChange:e=>g(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select buyer type..."}),(0,a.jsx)("option",{value:"local",children:"Local Buyer (within Malawi)"}),(0,a.jsx)("option",{value:"diaspora",children:"Diaspora Buyer (outside Malawi)"})]})]}),h&&(0,a.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:h}),(0,a.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,a.jsx)("button",{type:"button",onClick:()=>{c(!0),m(""),g(""),b("")},disabled:n,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:"Quick Mark"}),(0,a.jsx)("button",{type:"submit",disabled:n,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{size:18}),"Mark as Sold"]})})]})]})})]})})}function _(){let[e,t]=(0,r.useState)(null),[s,i]=(0,r.useState)(null),[h,y]=(0,r.useState)([]),[b,f]=(0,r.useState)([]),[j,v]=(0,r.useState)(!1),[_,S]=(0,r.useState)(null),[C,D]=(0,r.useState)(!0),[z,P]=(0,r.useState)(!1),[E,M]=(0,r.useState)(null),[Z,U]=(0,r.useState)(null),[I,T]=(0,r.useState)(null);(0,r.useEffect)(()=>{L()},[]),(0,r.useEffect)(()=>{if(!I)return;let e=setTimeout(()=>T(null),4e3);return()=>clearTimeout(e)},[I]);let L=async()=>{try{let{data:{user:e}}=await l.supabase.auth.getUser();if(!e)return;let{data:s}=await l.supabase.from("profiles").select("*").eq("id",e.id).maybeSingle();if(t(s),(null==s?void 0:s.user_type)==="agent"){let{data:t}=await l.supabase.from("agents").select("*").eq("user_id",e.id).maybeSingle();if(i(t),t){let{data:e,error:s}=await l.supabase.from("properties").select("*").eq("agent_id",t.id).order("created_at",{ascending:!1});s?console.error("❌ Error loading agent properties:",s):console.log("✅ Agent properties loaded:",{count:(null==e?void 0:e.length)||0,properties:null==e?void 0:e.map(e=>{var t;return{id:e.id,title:e.title,status:e.status,imagesCount:(null===(t=e.images)||void 0===t?void 0:t.length)||0}})}),y(e||[]);let{data:a}=await l.supabase.from("inquiries").select("*, properties(*)").in("property_id",(null==e?void 0:e.map(e=>e.id))||[]).order("created_at",{ascending:!1});f(a||[])}}else if((null==s?void 0:s.user_type)==="owner"){let{data:t,error:s}=await l.supabase.from("properties").select("*").eq("owner_id",e.id).order("created_at",{ascending:!1});s?console.error("❌ Error loading owner properties:",s):console.log("✅ Owner properties loaded:",{count:(null==t?void 0:t.length)||0,properties:null==t?void 0:t.map(e=>{var t;return{id:e.id,title:e.title,status:e.status,imagesCount:(null===(t=e.images)||void 0===t?void 0:t.length)||0}})}),y(t||[]);let{data:a}=await l.supabase.from("inquiries").select("*, properties(*)").in("property_id",(null==t?void 0:t.map(e=>e.id))||[]).order("created_at",{ascending:!1});f(a||[])}}catch(e){console.error("Error loading dashboard:",e)}finally{D(!1)}},q=async()=>{if(e)try{let{error:t}=await l.supabase.from("agents").insert({user_id:e.id,company_name:"",license_number:""});if(t)throw t;await L()}catch(e){console.error("Error creating agent profile:",e)}},A=(()=>{let e=h.reduce((e,t)=>e+t.views_count,0),t=h.reduce((e,t)=>e+t.inquiries_count,0),s=h.reduce((e,t)=>e+t.price,0),a=h.filter(e=>"sold"===e.status).length,r=h.length>0?a/h.length*100:0,l=h.filter(e=>"sold"===e.status&&e.sold_at);return{totalViews:e,totalInquiries:t,totalValue:s,totalSales:a,conversionRate:r,avgTimeToSale:Math.round(l.length>0?l.reduce((e,t)=>{let s=new Date(t.listed_at);return e+Math.floor((new Date(t.sold_at).getTime()-s.getTime())/864e5)},0)/l.length:0)}})(),R=e=>{U(e)},F=async(e,t)=>{try{let s={status:t};"sold"===t?s.sold_at=new Date().toISOString():s.sold_at=null;let{error:a}=await l.supabase.from("properties").update(s).eq("id",e);if(a)throw a;await L()}catch(e){console.error("Error updating property status:",e),alert("Failed to update property status")}},B=async e=>{if(confirm("Are you sure you want to delete this property? This cannot be undone."))try{let{error:t}=await l.supabase.from("properties").delete().eq("id",e);if(t)throw t;await L(),alert("Property deleted successfully")}catch(e){console.error("Error deleting property:",e),alert("Failed to delete property")}},O=async(e,t)=>{try{M(e);let s={status:t};"contacted"===t&&(s.responded_at=new Date().toISOString());let{error:a}=await l.supabase.from("inquiries").update(s).eq("id",e);if(a)throw a;await L()}catch(e){console.error("Error updating inquiry status:",e),alert("Failed to update inquiry status")}finally{M(null)}};return C?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-xl text-gray-600",children:"Loading dashboard..."})}):(null==e?void 0:e.user_type)!=="agent"||s?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[(0,a.jsxs)("div",{className:"container mx-auto px-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage your property listings"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[s&&(0,a.jsxs)("button",{onClick:()=>P(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[(0,a.jsx)(n,{size:18}),"Agent Profile"]}),(0,a.jsxs)("button",{onClick:()=>v(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[(0,a.jsx)(o.Z,{size:20}),"Add Property"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Listings"}),(0,a.jsx)(d.Z,{className:"text-blue-600",size:20})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:h.length}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[A.totalSales," sold"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Conversion Rate"}),(0,a.jsx)(d.Z,{className:"text-green-600",size:20})]}),(0,a.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:[A.conversionRate.toFixed(1),"%"]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[A.totalSales," / ",h.length," sold"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Views"}),(0,a.jsx)(c.Z,{className:"text-purple-600",size:20})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:A.totalViews}),(0,a.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[A.totalInquiries," inquiries"]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Avg Time to Sale"}),(0,a.jsx)(u.Z,{className:"text-orange-600",size:20})]}),(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900",children:A.avgTimeToSale||"N/A"}),(0,a.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:A.avgTimeToSale>0?"days":"No sales yet"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md mb-8",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Your Properties"})}),(0,a.jsx)("div",{className:"p-6",children:0===h.length?(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"You haven't listed any properties yet."}),(0,a.jsx)("button",{onClick:()=>v(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Add Your First Property"})]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Title"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Type"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Location"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Price"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Views"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Inquiries"}),(0,a.jsx)("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:h.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"py-3 px-4",children:e.title}),(0,a.jsx)("td",{className:"py-3 px-4 capitalize",children:e.property_type}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.district}),(0,a.jsxs)("td",{className:"py-3 px-4",children:[e.currency," ",e.price.toLocaleString()]}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("available"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.views_count}),(0,a.jsx)("td",{className:"py-3 px-4",children:e.inquiries_count}),(0,a.jsx)("td",{className:"py-3 px-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{value:e.status,onChange:t=>F(e.id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"available",children:"Available"}),(0,a.jsx)("option",{value:"pending",children:"Pending"}),(0,a.jsx)("option",{value:"sold",children:"Sold"}),(0,a.jsx)("option",{value:"withdrawn",children:"Withdrawn"})]}),(0,a.jsx)("button",{onClick:()=>{S(e),v(!0)},className:"text-blue-600 hover:text-blue-700 text-sm p-1",title:"Edit",children:(0,a.jsx)(m,{size:16})}),"sold"!==e.status&&(0,a.jsx)("button",{onClick:()=>R(e),className:"text-green-600 hover:text-green-700 text-sm p-1",title:"Mark as Sold",children:(0,a.jsx)(p.Z,{size:16})}),(0,a.jsx)("button",{onClick:()=>B(e.id),className:"text-red-600 hover:text-red-700 text-sm p-1",title:"Delete",children:(0,a.jsx)(x,{size:16})})]})})]},e.id))})]})})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Inquiries"})}),(0,a.jsx)("div",{className:"p-6",children:0===b.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-600",children:"No inquiries yet."})}):(0,a.jsx)("div",{className:"space-y-4",children:b.map(e=>{var t;let s=e.buyer_city&&e.buyer_country?"".concat(e.buyer_city,", ").concat(e.buyer_country):e.buyer_country?e.buyer_country:e.buyer_location||"Location not specified";return(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-2",children:null===(t=e.properties)||void 0===t?void 0:t.title}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCCD Buyer from:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:s})]}),e.buyer_name&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDC64 Name:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.buyer_name})]}),e.budget_range&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCB5 Budget:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.budget_range})]}),e.intended_use&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83C\uDFE0 Intent:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.intended_use})]}),e.payment_method_preference&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("span",{className:"text-gray-500",children:"\uD83D\uDCB3 Payment:"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.payment_method_preference})]})]})]}),(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap ml-4 ".concat("new"===e.status?"bg-blue-100 text-blue-800":"contacted"===e.status?"bg-yellow-100 text-yellow-800":"closed"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})]}),e.message&&(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[(0,a.jsx)("p",{className:"text-gray-700 text-sm",children:e.message}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2 italic",children:"Note: Buyer contact details are private. Respond via this platform or wait for buyer to contact you."})]}),(0,a.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Update Status:"}),(0,a.jsxs)("select",{value:e.status,onChange:t=>O(e.id,t.target.value),disabled:E===e.id,className:"text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:[(0,a.jsx)("option",{value:"new",children:"New"}),(0,a.jsx)("option",{value:"contacted",children:"Contacted"}),(0,a.jsx)("option",{value:"viewing_scheduled",children:"Viewing Scheduled"}),(0,a.jsx)("option",{value:"negotiating",children:"Negotiating"}),(0,a.jsx)("option",{value:"closed",children:"Closed"}),(0,a.jsx)("option",{value:"lost",children:"Lost"})]}),E===e.id&&(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Updating..."}),e.responded_at&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 ml-auto",children:["Responded: ",new Date(e.responded_at).toLocaleDateString()]})]})]},e.id)})})})]})]}),j&&(0,a.jsx)(N,{agent:s,userId:(null==e?void 0:e.id)||"",property:_,onClose:()=>{v(!1),S(null)},onSuccess:async e=>{let t=!!_;v(!1),S(null),await L(),T({message:(null==e?void 0:e.message)||(t?"Property updated successfully!":"Property added successfully!"),type:"success"})}}),z&&s&&(0,a.jsx)(k,{agent:s,onClose:()=>P(!1),onSuccess:()=>{P(!1),L()}}),Z&&(0,a.jsx)(w,{property:Z,onClose:()=>U(null),onSuccess:()=>{U(null),L()}}),I&&(0,a.jsx)("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-6 z-50",children:(0,a.jsxs)("div",{className:"max-w-sm ml-auto bg-white border-l-4 rounded-lg shadow-xl p-4 flex items-start gap-3 ".concat("success"===I.type?"border-green-500":"border-red-500"),children:["success"===I.type?(0,a.jsx)(p.Z,{className:"text-green-600 mt-0.5",size:18}):(0,a.jsx)(g.Z,{className:"text-red-600 mt-0.5",size:18}),(0,a.jsx)("div",{className:"flex-1 text-sm text-gray-800",children:I.message}),(0,a.jsx)("button",{onClick:()=>T(null),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Dismiss notification",children:"\xd7"})]})})]}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"Complete Your Agent Profile"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"To start listing properties, you need to create your agent profile."}),(0,a.jsx)("button",{onClick:q,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Create Agent Profile"})]})})}function k(e){let{agent:t,onClose:s,onSuccess:i}=e,[n,o]=(0,r.useState)({company_name:t.company_name||"",license_number:t.license_number||"",districts_covered:t.districts_covered||[]}),[d,c]=(0,r.useState)(""),[u,m]=(0,r.useState)(!1),p=async e=>{e.preventDefault(),m(!0);try{let{error:e}=await l.supabase.from("agents").update({company_name:n.company_name,license_number:n.license_number,districts_covered:n.districts_covered}).eq("id",t.id);if(e)throw e;i()}catch(e){console.error("Error updating agent profile:",e),alert("Failed to update agent profile")}finally{m(!1)}},x=()=>{d.trim()&&!n.districts_covered.includes(d.trim())&&(o({...n,districts_covered:[...n.districts_covered,d.trim()]}),c(""))},g=e=>{o({...n,districts_covered:n.districts_covered.filter(t=>t!==e)})};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"Agent Profile"}),(0,a.jsx)("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:(0,a.jsx)(h.Z,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:p,className:"p-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),(0,a.jsx)("input",{type:"text",value:n.company_name,onChange:e=>o({...n,company_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"License Number"}),(0,a.jsx)("input",{type:"text",value:n.license_number,onChange:e=>o({...n,license_number:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Districts Covered"}),(0,a.jsxs)("div",{className:"flex gap-2 mb-2",children:[(0,a.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),x()),placeholder:"Enter district name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,a.jsx)("button",{type:"button",onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add"})]}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:n.districts_covered.map(e=>(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[e,(0,a.jsx)("button",{type:"button",onClick:()=>g(e),className:"hover:text-blue-600",children:"\xd7"})]},e))})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 mt-6",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:u,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Saving...":"Save Changes"})]})]})]})})}}},function(e){e.O(0,[432,971,23,744],function(){return e(e.s=5312)}),_N_E=e.O()}]);