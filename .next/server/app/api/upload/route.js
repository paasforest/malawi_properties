"use strict";(()=>{var e={};e.id=998,e.ids=[998],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7869:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>E,staticGenerationAsyncStorage:()=>d});var o={};t.r(o),t.d(o,{POST:()=>p});var a=t(9303),n=t(8716),s=t(670),i=t(7070),l=t(4392);async function p(e){try{console.log("\uD83D\uDCE5 Upload API: Received request");let r=await e.formData(),t=r.get("file"),o=r.get("path");if(console.log("\uD83D\uDCE5 Upload API: Extracted data",{fileName:t?.name,fileSize:t?.size,fileType:t?.type,path:o}),!t||!o)return console.error("❌ Upload API: Missing file or path",{hasFile:!!t,hasPath:!!o}),i.NextResponse.json({error:"File and path are required"},{status:400});let a=await t.arrayBuffer(),n=Buffer.from(a);console.log("\uD83D\uDCE4 Upload API: Uploading to Hetzner...",{path:o,size:n.length});let s=await (0,l.cT)(n,o,t.type);return console.log("✅ Upload API: Upload successful",{url:s}),i.NextResponse.json({url:s},{status:200})}catch(r){console.error("❌ Upload API error:",r);let e=r instanceof Error?r.message:"Upload failed";return console.error("❌ Upload API error details:",{message:e,stack:r instanceof Error?r.stack:void 0}),i.NextResponse.json({error:e},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/home/paas/Hope properties/app/api/upload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:u,staticGenerationAsyncStorage:d,serverHooks:E}=c,f="/api/upload/route";function h(){return(0,s.patchFetch)({serverHooks:E,staticGenerationAsyncStorage:d})}},4392:(e,r,t)=>{t.d(r,{_I:()=>c,cl:()=>u,cT:()=>p});let o=require("@aws-sdk/client-s3");function a(){return new o.S3Client({endpoint:process.env.HETZNER_S3_ENDPOINT,region:process.env.HETZNER_S3_REGION||"fsn1",credentials:{accessKeyId:process.env.HETZNER_S3_ACCESS_KEY||"",secretAccessKey:process.env.HETZNER_S3_SECRET_KEY||""},forcePathStyle:!0})}let n=process.env.HETZNER_S3_BUCKET||"hope-properties-images",s=process.env.HETZNER_CDN_URL,i=process.env.HETZNER_S3_ENDPOINT,l="false"!==process.env.HETZNER_S3_BUCKET_PUBLIC;async function p(e,r,t="image/jpeg"){let p=a(),c=new o.PutObjectCommand({Bucket:n,Key:r,Body:e,ContentType:t,CacheControl:"public, max-age=31536000",...l?{ACL:"public-read"}:{}});try{if(await p.send(c),!l&&!s)throw Error("Private bucket requires HETZNER_CDN_URL to be configured");if(s)return`${s}/${r}`;if(i&&l)return`${i}/${n}/${r}`;throw Error("No CDN URL or public S3 endpoint configured")}catch(e){throw console.error("❌ Upload failed:",e),Error(`Failed to upload file: ${e instanceof Error?e.message:"Unknown error"}`)}}async function c(e){let r=a(),t=new o.DeleteObjectCommand({Bucket:n,Key:e});try{await r.send(t)}catch(e){throw console.error("❌ Delete failed:",e),Error(`Failed to delete file: ${e instanceof Error?e.message:"Unknown error"}`)}}function u(e){try{if(s&&e.startsWith(s))return e.replace(s+"/","");if((process.env.NEXT_PUBLIC_HETZNER_S3_ENDPOINT||process.env.HETZNER_S3_ENDPOINT)&&e.includes(`/${n}/`))return e.split(`/${n}/`)[1]||null;let r=new URL(e);return r.pathname.startsWith("/")?r.pathname.slice(1):r.pathname}catch{return null}}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972],()=>t(7869));module.exports=o})();