(()=>{var e={};e.id=702,e.ids=[702],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},8955:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),s(8550),s(4294),s(5866);var r=s(3191),a=s(8716),l=s(7922),i=s.n(l),o=s(5231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(t,n);let d=["",{children:["dashboard",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8550)),"/home/paas/Hope properties/app/dashboard/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,4294)),"/home/paas/Hope properties/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/home/paas/Hope properties/app/dashboard/page.tsx"],u="/dashboard/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/page",pathname:"/dashboard",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},5438:(e,t,s)=>{Promise.resolve().then(s.bind(s,112))},7888:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},4659:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},8998:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},2714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},7069:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},1470:(e,t,s)=>{"use strict";s.d(t,{Z:()=>r});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s(6557).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},112:(e,t,s)=>{"use strict";s.d(t,{Dashboard:()=>w});var r=s(326),a=s(7577),l=s(2777),i=s(6557);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,i.Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);var n=s(3855),d=s(7069),c=s(2714),u=s(8998);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,i.Z)("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);var m=s(4659);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let x=(0,i.Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var g=s(7888),h=s(1470),b=s(4019);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let y=(0,i.Z)("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);async function f(e,t){let s=new FormData;s.append("file",e),s.append("path",t),console.log("\uD83D\uDCE4 Sending upload request to /api/upload",{path:t,fileName:e.name,fileSize:e.size});let r=await fetch("/api/upload",{method:"POST",body:s});if(console.log("\uD83D\uDCE5 Upload response:",{status:r.status,ok:r.ok}),!r.ok){let e=await r.json().catch(()=>({message:"Upload failed"}));throw console.error("âŒ Upload API error:",e),Error(e.error||e.message||`Upload failed with status ${r.status}`)}let a=await r.json();return console.log("âœ… Upload successful, URL:",a.url),a.url}require("@aws-sdk/client-s3"),process.env.HETZNER_S3_BUCKET,process.env.HETZNER_CDN_URL,process.env.HETZNER_S3_ENDPOINT,process.env.HETZNER_S3_BUCKET_PUBLIC;let j=["Blantyre","Lilongwe","Mzuzu","Zomba","Mangochi","Kasungu","Salima","Nkhotakota","Dedza","Ntchisi","Dowa","Mchinji","Karonga","Chitipa","Rumphi","Nkhata Bay","Likoma","Balaka","Chiradzulu","Mulanje","Phalombe","Thyolo","Chikwawa","Nsanje","Machinga","Mwanza","Neno","Ntcheu"];function v({agent:e,userId:t,property:s,onClose:i,onSuccess:o}){let[n,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(""),[p,m]=(0,a.useState)(""),[g,h]=(0,a.useState)({title:"",description:"",property_type:"land",district:"",area:"",price:"",currency:"MWK",plot_size:"",plot_dimensions:"",bedrooms:"",bathrooms:"",has_title_deed:!1,documentation_type:"",reason_for_selling:"",is_urgent_sale:!1,status:"available"}),[v,N]=(0,a.useState)([]),[w,_]=(0,a.useState)([]),[k,S]=(0,a.useState)([]),C=e=>{N(t=>t.filter((t,s)=>s!==e))},D=e=>{_(t=>t.filter((t,s)=>s!==e)),S(t=>{let s=[...t],[r]=s.splice(e,1);return r&&URL.revokeObjectURL(r),s})},P=e=>{if(!e||!e.trim())return null;let t=e.trim().toLowerCase(),s=t.match(/(\d+(?:\.\d+)?)\s*by\s*(\d+(?:\.\d+)?)/);if(s){let e=parseFloat(s[1]),t=parseFloat(s[2]);if(!isNaN(e)&&!isNaN(t)&&e>0&&t>0)return Math.round(e*t*100)/100}let r=t.match(/(\d+(?:\.\d+)?)\s*x\s*(\d+(?:\.\d+)?)/);if(r){let e=parseFloat(r[1]),t=parseFloat(r[2]);if(!isNaN(e)&&!isNaN(t)&&e>0&&t>0)return Math.round(e*t*100)/100}return null},z=e=>{let t=P(e);null!==t?h(s=>({...s,plot_dimensions:e,plot_size:t.toString()})):e.trim()?h(t=>({...t,plot_dimensions:e})):h(t=>({...t,plot_dimensions:e,plot_size:""}))},q=async()=>{if(!w.length)return console.log("\uD83D\uDCF8 No new images to upload"),[];console.log(`ðŸ“¸ Uploading ${w.length} image(s) to Hetzner Storage...`);let e=[];for(let s of w){let r=s.name.split(".").pop()||"jpg",a=`property-${t}/${Date.now()}-${Math.random().toString(36).substring(2)}.${r}`;console.log(`  Uploading: ${s.name} -> ${a}`);try{let t=await f(s,a);console.log(`  âœ… Uploaded: ${t}`),e.push(t)}catch(e){throw console.error(`  âŒ Upload failed for ${s.name}:`,e),Error(`Failed to upload ${s.name}: ${e.message||"Unknown error"}`)}}return console.log(`âœ… All images uploaded: ${e.length} URL(s)`),e},E=async()=>{if(s&&window.confirm(`Are you sure you want to delete "${s.title}"?

This action cannot be undone. The property and all its associated data will be permanently removed.`)){d(!0),u("");try{if(console.log(`ðŸ—‘ï¸ Deleting property: ${s.title}`),v.length>0)for(let e of(console.log(`ðŸ—‘ï¸ Deleting ${v.length} image(s) from Hetzner storage...`),v))try{if(e.includes("your-objectstorage.com")||e.includes("hetzner")){let t=await fetch("/api/delete-image",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e})});if(t.ok)console.log(`  âœ… Deleted image: ${e}`);else{let s=await t.json().catch(()=>({message:"Delete failed"}));console.warn(`  âš ï¸ Failed to delete image ${e}:`,s.error||s.message)}}else console.log(`  â­ï¸ Skipping Supabase image (bucket may be deleted): ${e}`)}catch(t){console.warn(`  âš ï¸ Error deleting image ${e}:`,t)}let{error:t}=await l.supabase.from("properties").delete().eq("id",s.id);if(t)throw t;e&&e.total_listings>0&&await l.supabase.from("agents").update({total_listings:Math.max(0,e.total_listings-1)}).eq("id",e.id),console.log("âœ… Property deleted successfully:",s.id),o({message:"Property deleted successfully!"}),i()}catch(e){console.error("âŒ Error deleting property:",e),u(e.message||"Failed to delete property"),d(!1)}}},M=async r=>{r.preventDefault(),d(!0),u("");try{let r=await q(),a=[...v,...r],i=null,n={title:g.title,description:g.description||null,property_type:g.property_type,district:g.district,area:g.area||null,price:parseFloat(g.price),currency:g.currency,plot_size:g.plot_size?parseFloat(g.plot_size):null,bedrooms:g.bedrooms?parseInt(g.bedrooms):0,bathrooms:g.bathrooms?parseInt(g.bathrooms):0,has_title_deed:g.has_title_deed,documentation_type:g.documentation_type||null,reason_for_selling:g.reason_for_selling||null,is_urgent_sale:g.is_urgent_sale,status:g.status,images:a.length>0?a:[],agent_id:e?.id||null,owner_id:e?null:t};if(console.log("\uD83D\uDCBE Saving property data:",{title:n.title,status:n.status,imagesCount:n.images.length,images:n.images,agent_id:n.agent_id,owner_id:n.owner_id}),s){let{data:e,error:t}=await l.supabase.from("properties").update(n).eq("id",s.id).select("*").single();if(t)throw t;i=e,N(a)}else{let{data:t,error:s}=await l.supabase.from("properties").insert(n).select("*").single();if(s)throw s;i=t,e&&await l.supabase.from("agents").update({total_listings:e.total_listings+1}).eq("id",e.id)}_([]),S(e=>(e.forEach(e=>URL.revokeObjectURL(e)),[]));let d=s?"Property updated successfully!":"Property added successfully!";console.log("âœ… Property saved successfully:",{id:i?.id,title:i?.title,status:i?.status,imagesCount:i?.images?.length||0,images:i?.images}),o({message:d,property:i||void 0})}catch(e){console.error("âŒ Error saving property:",e),u(e.message||"Failed to save property")}finally{d(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s?"Edit Property":"Add New Property"}),r.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:r.jsx(b.Z,{size:24})})]}),(0,r.jsxs)("form",{onSubmit:M,className:"p-6",children:[c&&r.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded-lg",children:c}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Photos"}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsxs)("label",{className:"w-full cursor-pointer flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-blue-500 hover:text-blue-600 transition-colors",children:[r.jsx(y,{size:20}),r.jsx("span",{className:"text-sm font-medium",children:"Click to upload (PNG, JPG up to 5MB each)"}),r.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:e=>{m("");let t=Array.from(e.target.files||[]);if(!t.length){_([]),S(e=>(e.forEach(e=>URL.revokeObjectURL(e)),[]));return}if(t.length+v.length>10){m("Please upload up to 10 images in total.");return}let s=t.find(e=>e.size>5242880);if(s){m(`"${s.name}" is too large. Max size is 5MB per image.`);return}let r=t.map(e=>URL.createObjectURL(e));_(t),S(e=>(e.forEach(e=>URL.revokeObjectURL(e)),r))}})]}),r.jsx("p",{className:"text-xs text-gray-500",children:"You can upload up to 10 images. The first photo will be used as the cover image."}),p&&r.jsx("p",{className:"text-sm text-red-600",children:p})]}),(v.length>0||k.length>0)&&(0,r.jsxs)("div",{className:"mt-4 space-y-4",children:[v.length>0&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs uppercase text-gray-500 mb-2",children:"Existing Images"}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:v.map((e,t)=>(0,r.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200",children:[r.jsx("img",{src:e,alt:`Property image ${t+1}`,className:"w-full h-32 object-cover"}),r.jsx("button",{type:"button",onClick:()=>C(t),className:"absolute top-2 right-2 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:r.jsx(x,{size:14})})]},e))})]}),k.length>0&&(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-xs uppercase text-gray-500 mb-2",children:"New Images"}),r.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:k.map((e,t)=>(0,r.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-200",children:[r.jsx("img",{src:e,alt:`New property image ${t+1}`,className:"w-full h-32 object-cover"}),r.jsx("button",{type:"button",onClick:()=>D(t),className:"absolute top-2 right-2 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:r.jsx(x,{size:14})})]},e))})]})]})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Title *"}),r.jsx("input",{type:"text",required:!0,value:g.title,onChange:e=>h({...g,title:e.target.value}),placeholder:"e.g., 3 Bedroom House in Area 47",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{value:g.description,onChange:e=>h({...g,description:e.target.value}),rows:4,placeholder:"Describe the property...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Property Type *"}),(0,r.jsxs)("select",{required:!0,value:g.property_type,onChange:e=>h({...g,property_type:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"land",children:"Land"}),r.jsx("option",{value:"house",children:"House"}),r.jsx("option",{value:"rental",children:"Rental"}),r.jsx("option",{value:"commercial",children:"Commercial"}),r.jsx("option",{value:"mixed",children:"Mixed Use"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"District *"}),(0,r.jsxs)("select",{required:!0,value:g.district,onChange:e=>h({...g,district:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"",children:"Select district"}),j.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Specific Area"}),r.jsx("input",{type:"text",value:g.area,onChange:e=>h({...g,area:e.target.value}),placeholder:"e.g., Area 47, Sector 3",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,r.jsxs)("select",{value:g.status,onChange:e=>h({...g,status:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"available",children:"Available"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"sold",children:"Sold"}),r.jsx("option",{value:"withdrawn",children:"Withdrawn"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price *"}),r.jsx("input",{type:"number",required:!0,value:g.price,onChange:e=>h({...g,price:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency *"}),(0,r.jsxs)("select",{required:!0,value:g.currency,onChange:e=>h({...g,currency:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[r.jsx("option",{value:"MWK",children:"MWK"}),r.jsx("option",{value:"USD",children:"USD"}),r.jsx("option",{value:"ZAR",children:"ZAR"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plot Dimensions (meters)"}),r.jsx("input",{type:"text",value:g.plot_dimensions,onChange:e=>z(e.target.value),placeholder:"e.g., 23 by 25 or 23x25",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsx("p",{className:"mt-1 text-xs text-gray-500",children:'Enter dimensions like "23 by 25" or "23x25" (automatically calculates area)'})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Plot Size (m\xb2) ",r.jsx("span",{className:"text-gray-400 text-xs",children:"(calculated automatically)"})]}),r.jsx("input",{type:"number",value:g.plot_size,onChange:e=>h({...g,plot_size:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50",readOnly:!!g.plot_dimensions,title:g.plot_dimensions?"Calculated from dimensions above":""})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bedrooms"}),r.jsx("input",{type:"number",value:g.bedrooms,onChange:e=>h({...g,bedrooms:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bathrooms"}),r.jsx("input",{type:"number",value:g.bathrooms,onChange:e=>h({...g,bathrooms:e.target.value}),placeholder:"0",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Documentation Type"}),r.jsx("input",{type:"text",value:g.documentation_type,onChange:e=>h({...g,documentation_type:e.target.value}),placeholder:"e.g., Title Deed, Lease Agreement",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason for Selling (optional)"}),r.jsx("input",{type:"text",value:g.reason_for_selling,onChange:e=>h({...g,reason_for_selling:e.target.value}),placeholder:"e.g., Relocation, Investment, Financial",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"has_title_deed",checked:g.has_title_deed,onChange:e=>h({...g,has_title_deed:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"has_title_deed",className:"ml-2 text-sm text-gray-700",children:"Has Title Deed"})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",id:"is_urgent_sale",checked:g.is_urgent_sale,onChange:e=>h({...g,is_urgent_sale:e.target.checked}),className:"w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"}),r.jsx("label",{htmlFor:"is_urgent_sale",className:"ml-2 text-sm text-gray-700",children:"Urgent Sale"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-6",children:[s&&(0,r.jsxs)("button",{type:"button",onClick:E,disabled:n,className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[r.jsx(x,{size:18}),"Delete"]}),r.jsx("button",{type:"button",onClick:i,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:n,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Saving...":s?"Update Property":"Add Property"})]})]})]})})}function N({property:e,onClose:t,onSuccess:l}){let[i,o]=(0,a.useState)(!1),[n,d]=(0,a.useState)(!0),[c,u]=(0,a.useState)(""),[p,x]=(0,a.useState)(""),[g,h]=(0,a.useState)(""),y=async()=>{o(!0),h("");try{let{supabase:r}=await Promise.resolve().then(s.bind(s,2777)),{error:a}=await r.from("properties").update({status:"sold",sold_at:new Date().toISOString(),sale_price:null,buyer_type:null}).eq("id",e.id);if(a)throw a;l(),t()}catch(e){h(e.message||"Failed to mark property as sold")}finally{o(!1)}},f=async r=>{r.preventDefault(),o(!0),h("");try{let{supabase:r}=await Promise.resolve().then(s.bind(s,2777)),a={status:"sold",sold_at:new Date().toISOString()};if(c){let e=parseFloat(c);if(isNaN(e)||e<0)throw Error("Sale price must be a valid positive number");a.sale_price=e}p&&(a.buyer_type=p);let{error:i}=await r.from("properties").update(a).eq("id",e.id);if(i)throw i;l(),t()}catch(e){h(e.message||"Failed to mark property as sold")}finally{o(!1)}};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:r.jsx(m.Z,{className:"text-green-600",size:24})}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Mark as Sold"}),r.jsx("p",{className:"text-sm text-gray-600",children:e.title})]})]}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",disabled:i,children:r.jsx(b.Z,{size:20})})]}),r.jsx("div",{className:"p-6",children:n?(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-gray-700",children:"Mark this property as sold? It will be hidden from the marketplace but remain visible in your dashboard."}),g&&r.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:g}),(0,r.jsxs)("div",{className:"flex gap-3",children:[r.jsx("button",{type:"button",onClick:t,disabled:i,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:"Cancel"}),r.jsx("button",{type:"button",onClick:y,disabled:i,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:i?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Marking..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(m.Z,{size:18}),"Mark as Sold"]})})]}),r.jsx("button",{type:"button",onClick:()=>d(!1),className:"w-full text-sm text-blue-600 hover:text-blue-700 text-center py-2",children:"+ Add sale details (optional)"})]}):(0,r.jsxs)("form",{onSubmit:f,className:"space-y-4",children:[r.jsx("p",{className:"text-gray-700 text-sm mb-4",children:"Help us improve market intelligence by sharing sale details. All fields are optional."}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Sale Price (",e.currency,")",r.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),r.jsx("input",{type:"number",value:c,onChange:e=>u(e.target.value),placeholder:e.price.toString(),min:"0",step:"0.01",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Listed price: ",e.currency," ",e.price.toLocaleString()]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Buyer Type",r.jsx("span",{className:"text-gray-500 font-normal ml-1",children:"(optional)"})]}),(0,r.jsxs)("select",{value:p,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[r.jsx("option",{value:"",children:"Select buyer type..."}),r.jsx("option",{value:"local",children:"Local Buyer (within Malawi)"}),r.jsx("option",{value:"diaspora",children:"Diaspora Buyer (outside Malawi)"})]})]}),g&&r.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:g}),(0,r.jsxs)("div",{className:"flex gap-3 pt-2",children:[r.jsx("button",{type:"button",onClick:()=>{d(!0),u(""),x(""),h("")},disabled:i,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:"Quick Mark"}),r.jsx("button",{type:"submit",disabled:i,className:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-medium disabled:opacity-50 flex items-center justify-center gap-2",children:i?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Saving..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(m.Z,{size:18}),"Mark as Sold"]})})]})]})})]})})}function w(){let[e,t]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),[h,b]=(0,a.useState)([]),[y,f]=(0,a.useState)([]),[j,w]=(0,a.useState)(!1),[k,S]=(0,a.useState)(null),[C,D]=(0,a.useState)(!0),[P,z]=(0,a.useState)(!1),[q,E]=(0,a.useState)(null),[M,Z]=(0,a.useState)(null),[T,U]=(0,a.useState)(null),A=async()=>{try{let{data:{user:e}}=await l.supabase.auth.getUser();if(!e)return;let{data:s}=await l.supabase.from("profiles").select("*").eq("id",e.id).maybeSingle();if(t(s),s?.user_type==="agent"){let{data:t}=await l.supabase.from("agents").select("*").eq("user_id",e.id).maybeSingle();if(i(t),t){let{data:e,error:s}=await l.supabase.from("properties").select("*").eq("agent_id",t.id).order("created_at",{ascending:!1});s?console.error("âŒ Error loading agent properties:",s):console.log("âœ… Agent properties loaded:",{count:e?.length||0,properties:e?.map(e=>({id:e.id,title:e.title,status:e.status,imagesCount:e.images?.length||0}))}),b(e||[]);let{data:r}=await l.supabase.from("inquiries").select("*, properties(*)").in("property_id",e?.map(e=>e.id)||[]).order("created_at",{ascending:!1});f(r||[])}}else if(s?.user_type==="owner"){let{data:t,error:s}=await l.supabase.from("properties").select("*").eq("owner_id",e.id).order("created_at",{ascending:!1});s?console.error("âŒ Error loading owner properties:",s):console.log("âœ… Owner properties loaded:",{count:t?.length||0,properties:t?.map(e=>({id:e.id,title:e.title,status:e.status,imagesCount:e.images?.length||0}))}),b(t||[]);let{data:r}=await l.supabase.from("inquiries").select("*, properties(*)").in("property_id",t?.map(e=>e.id)||[]).order("created_at",{ascending:!1});f(r||[])}}catch(e){console.error("Error loading dashboard:",e)}finally{D(!1)}},L=async()=>{if(e)try{let{error:t}=await l.supabase.from("agents").insert({user_id:e.id,company_name:"",license_number:""});if(t)throw t;await A()}catch(e){console.error("Error creating agent profile:",e)}},R=(()=>{let e=h.reduce((e,t)=>e+t.views_count,0),t=h.reduce((e,t)=>e+t.inquiries_count,0),s=h.reduce((e,t)=>e+t.price,0),r=h.filter(e=>"sold"===e.status).length,a=h.length>0?r/h.length*100:0,l=h.filter(e=>"sold"===e.status&&e.sold_at);return{totalViews:e,totalInquiries:t,totalValue:s,totalSales:r,conversionRate:a,avgTimeToSale:Math.round(l.length>0?l.reduce((e,t)=>{let s=new Date(t.listed_at);return e+Math.floor((new Date(t.sold_at).getTime()-s.getTime())/864e5)},0)/l.length:0)}})(),F=e=>{Z(e)},$=async(e,t)=>{try{let s={status:t};"sold"===t?s.sold_at=new Date().toISOString():s.sold_at=null;let{error:r}=await l.supabase.from("properties").update(s).eq("id",e);if(r)throw r;await A()}catch(e){console.error("Error updating property status:",e),alert("Failed to update property status")}},B=async e=>{if(confirm("Are you sure you want to delete this property? This cannot be undone."))try{let{error:t}=await l.supabase.from("properties").delete().eq("id",e);if(t)throw t;await A(),alert("Property deleted successfully")}catch(e){console.error("Error deleting property:",e),alert("Failed to delete property")}},I=async(e,t)=>{try{E(e);let s={status:t};"contacted"===t&&(s.responded_at=new Date().toISOString());let{error:r}=await l.supabase.from("inquiries").update(s).eq("id",e);if(r)throw r;await A()}catch(e){console.error("Error updating inquiry status:",e),alert("Failed to update inquiry status")}finally{E(null)}};return C?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:r.jsx("div",{className:"text-xl text-gray-600",children:"Loading dashboard..."})}):e?.user_type!=="agent"||s?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50 py-8",children:[(0,r.jsxs)("div",{className:"container mx-auto px-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Manage your property listings"})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[s&&(0,r.jsxs)("button",{onClick:()=>z(!0),className:"flex items-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:[r.jsx(o,{size:18}),"Agent Profile"]}),(0,r.jsxs)("button",{onClick:()=>w(!0),className:"flex items-center gap-2 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:[r.jsx(n.Z,{size:20}),"Add Property"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-gray-600",children:"Total Listings"}),r.jsx(d.Z,{className:"text-blue-600",size:20})]}),r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:h.length}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[R.totalSales," sold"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-gray-600",children:"Conversion Rate"}),r.jsx(d.Z,{className:"text-green-600",size:20})]}),(0,r.jsxs)("div",{className:"text-3xl font-bold text-gray-900",children:[R.conversionRate.toFixed(1),"%"]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[R.totalSales," / ",h.length," sold"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-gray-600",children:"Total Views"}),r.jsx(c.Z,{className:"text-purple-600",size:20})]}),r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:R.totalViews}),(0,r.jsxs)("div",{className:"text-sm text-gray-500 mt-1",children:[R.totalInquiries," inquiries"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("span",{className:"text-gray-600",children:"Avg Time to Sale"}),r.jsx(u.Z,{className:"text-orange-600",size:20})]}),r.jsx("div",{className:"text-3xl font-bold text-gray-900",children:R.avgTimeToSale||"N/A"}),r.jsx("div",{className:"text-sm text-gray-500 mt-1",children:R.avgTimeToSale>0?"days":"No sales yet"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md mb-8",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Your Properties"})}),r.jsx("div",{className:"p-6",children:0===h.length?(0,r.jsxs)("div",{className:"text-center py-12",children:[r.jsx("p",{className:"text-gray-600 mb-4",children:"You haven't listed any properties yet."}),r.jsx("button",{onClick:()=>w(!0),className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Add Your First Property"})]}):r.jsx("div",{className:"overflow-x-auto",children:(0,r.jsxs)("table",{className:"w-full",children:[r.jsx("thead",{children:(0,r.jsxs)("tr",{className:"border-b border-gray-200",children:[r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Title"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Type"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Location"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Price"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Status"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Views"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Inquiries"}),r.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-900",children:"Actions"})]})}),r.jsx("tbody",{children:h.map(e=>(0,r.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[r.jsx("td",{className:"py-3 px-4",children:e.title}),r.jsx("td",{className:"py-3 px-4 capitalize",children:e.property_type}),r.jsx("td",{className:"py-3 px-4",children:e.district}),(0,r.jsxs)("td",{className:"py-3 px-4",children:[e.currency," ",e.price.toLocaleString()]}),r.jsx("td",{className:"py-3 px-4",children:r.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${"available"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:e.status})}),r.jsx("td",{className:"py-3 px-4",children:e.views_count}),r.jsx("td",{className:"py-3 px-4",children:e.inquiries_count}),r.jsx("td",{className:"py-3 px-4",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("select",{value:e.status,onChange:t=>$(e.id,t.target.value),className:"text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500",children:[r.jsx("option",{value:"available",children:"Available"}),r.jsx("option",{value:"pending",children:"Pending"}),r.jsx("option",{value:"sold",children:"Sold"}),r.jsx("option",{value:"withdrawn",children:"Withdrawn"})]}),r.jsx("button",{onClick:()=>{S(e),w(!0)},className:"text-blue-600 hover:text-blue-700 text-sm p-1",title:"Edit",children:r.jsx(p,{size:16})}),"sold"!==e.status&&r.jsx("button",{onClick:()=>F(e),className:"text-green-600 hover:text-green-700 text-sm p-1",title:"Mark as Sold",children:r.jsx(m.Z,{size:16})}),r.jsx("button",{onClick:()=>B(e.id),className:"text-red-600 hover:text-red-700 text-sm p-1",title:"Delete",children:r.jsx(x,{size:16})})]})})]},e.id))})]})})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Recent Inquiries"})}),r.jsx("div",{className:"p-6",children:0===y.length?r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-gray-600",children:"No inquiries yet."})}):r.jsx("div",{className:"space-y-4",children:y.map(e=>{let t=e.buyer_city&&e.buyer_country?`${e.buyer_city}, ${e.buyer_country}`:e.buyer_country?e.buyer_country:e.buyer_location||"Location not specified";return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:e.properties?.title}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCCD Buyer from:"}),r.jsx("span",{className:"font-medium text-gray-900",children:t})]}),e.buyer_name&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83D\uDC64 Name:"}),r.jsx("span",{className:"font-medium text-gray-900",children:e.buyer_name})]}),e.budget_range&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCB5 Budget:"}),r.jsx("span",{className:"font-medium text-gray-900",children:e.budget_range})]}),e.intended_use&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83C\uDFE0 Intent:"}),r.jsx("span",{className:"font-medium text-gray-900",children:e.intended_use})]}),e.payment_method_preference&&(0,r.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[r.jsx("span",{className:"text-gray-500",children:"\uD83D\uDCB3 Payment:"}),r.jsx("span",{className:"font-medium text-gray-900",children:e.payment_method_preference})]})]})]}),r.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-semibold whitespace-nowrap ml-4 ${"new"===e.status?"bg-blue-100 text-blue-800":"contacted"===e.status?"bg-yellow-100 text-yellow-800":"closed"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.status})]}),e.message&&(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[r.jsx("p",{className:"text-gray-700 text-sm",children:e.message}),r.jsx("p",{className:"text-xs text-gray-500 mt-2 italic",children:"Note: Buyer contact details are private. Respond via this platform or wait for buyer to contact you."})]}),(0,r.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-200 flex items-center gap-2",children:[r.jsx("span",{className:"text-xs text-gray-600",children:"Update Status:"}),(0,r.jsxs)("select",{value:e.status,onChange:t=>I(e.id,t.target.value),disabled:q===e.id,className:"text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:[r.jsx("option",{value:"new",children:"New"}),r.jsx("option",{value:"contacted",children:"Contacted"}),r.jsx("option",{value:"viewing_scheduled",children:"Viewing Scheduled"}),r.jsx("option",{value:"negotiating",children:"Negotiating"}),r.jsx("option",{value:"closed",children:"Closed"}),r.jsx("option",{value:"lost",children:"Lost"})]}),q===e.id&&r.jsx("span",{className:"text-xs text-gray-500",children:"Updating..."}),e.responded_at&&(0,r.jsxs)("span",{className:"text-xs text-gray-500 ml-auto",children:["Responded: ",new Date(e.responded_at).toLocaleDateString()]})]})]},e.id)})})})]})]}),j&&r.jsx(v,{agent:s,userId:e?.id||"",property:k,onClose:()=>{w(!1),S(null)},onSuccess:async e=>{let t=!!k;w(!1),S(null),await A(),U({message:e?.message||(t?"Property updated successfully!":"Property added successfully!"),type:"success"})}}),P&&s&&r.jsx(_,{agent:s,onClose:()=>z(!1),onSuccess:()=>{z(!1),A()}}),M&&r.jsx(N,{property:M,onClose:()=>Z(null),onSuccess:()=>{Z(null),A()}}),T&&r.jsx("div",{className:"fixed bottom-4 left-4 right-4 sm:left-auto sm:right-6 z-50",children:(0,r.jsxs)("div",{className:`max-w-sm ml-auto bg-white border-l-4 rounded-lg shadow-xl p-4 flex items-start gap-3 ${"success"===T.type?"border-green-500":"border-red-500"}`,children:["success"===T.type?r.jsx(m.Z,{className:"text-green-600 mt-0.5",size:18}):r.jsx(g.Z,{className:"text-red-600 mt-0.5",size:18}),r.jsx("div",{className:"flex-1 text-sm text-gray-800",children:T.message}),r.jsx("button",{onClick:()=>U(null),className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Dismiss notification",children:"\xd7"})]})})]}):r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-8 max-w-md",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Complete Your Agent Profile"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"To start listing properties, you need to create your agent profile."}),r.jsx("button",{onClick:L,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Create Agent Profile"})]})})}function _({agent:e,onClose:t,onSuccess:s}){let[i,o]=(0,a.useState)({company_name:e.company_name||"",license_number:e.license_number||"",districts_covered:e.districts_covered||[]}),[n,d]=(0,a.useState)(""),[c,u]=(0,a.useState)(!1),p=async t=>{t.preventDefault(),u(!0);try{let{error:t}=await l.supabase.from("agents").update({company_name:i.company_name,license_number:i.license_number,districts_covered:i.districts_covered}).eq("id",e.id);if(t)throw t;s()}catch(e){console.error("Error updating agent profile:",e),alert("Failed to update agent profile")}finally{u(!1)}},m=()=>{n.trim()&&!i.districts_covered.includes(n.trim())&&(o({...i,districts_covered:[...i.districts_covered,n.trim()]}),d(""))},x=e=>{o({...i,districts_covered:i.districts_covered.filter(t=>t!==e)})};return r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"sticky top-0 bg-white border-b border-gray-200 p-4 flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Agent Profile"}),r.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:r.jsx(h.Z,{size:24})})]}),(0,r.jsxs)("form",{onSubmit:p,className:"p-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company Name"}),r.jsx("input",{type:"text",value:i.company_name,onChange:e=>o({...i,company_name:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"License Number"}),r.jsx("input",{type:"text",value:i.license_number,onChange:e=>o({...i,license_number:e.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Districts Covered"}),(0,r.jsxs)("div",{className:"flex gap-2 mb-2",children:[r.jsx("input",{type:"text",value:n,onChange:e=>d(e.target.value),onKeyPress:e=>"Enter"===e.key&&(e.preventDefault(),m()),placeholder:"Enter district name",className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),r.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Add"})]}),r.jsx("div",{className:"flex flex-wrap gap-2",children:i.districts_covered.map(e=>(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm",children:[e,r.jsx("button",{type:"button",onClick:()=>x(e),className:"hover:text-blue-600",children:"\xd7"})]},e))})]})]}),(0,r.jsxs)("div",{className:"flex gap-3 mt-6",children:[r.jsx("button",{type:"button",onClick:t,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium",children:"Cancel"}),r.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Saving...":"Save Changes"})]})]})]})})}},8550:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var r=s(9510),a=s(8570);let l=(0,a.createProxy)(String.raw`/home/paas/Hope properties/src/views/Dashboard.tsx`),{__esModule:i,$$typeof:o}=l;l.default;let n=(0,a.createProxy)(String.raw`/home/paas/Hope properties/src/views/Dashboard.tsx#Dashboard`);function d(){return r.jsx(n,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,799,815],()=>s(8955));module.exports=r})();